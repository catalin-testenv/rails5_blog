
<% title = resource_view_listing_message(resource: PageCategory, count: 2) %>

<% content_for :title do %>
    <%= title %>
<% end %>

<%= admin_body_title("#{icon_list}&nbsp;&nbsp;#{title} (#{@resource_list.count})") %>

<!-- results area -->
<div>
<%=
  def page_categories_tree
    ids = {}
    @resource_list.map.with_object([]) do |item, arr|
      obj = {
              id: item.id,
              name: item.name,
              link: page_category_path(item),
              children: []}

      ids[item.id] = obj
      if item.parent_id == 0
        arr << obj
      else
        ids[item.parent_id][:children] << obj
      end
    end
  end

  def page_categories_html(arr: page_categories_tree, _count: 0)
    html = ''
    return html if arr.length == 0
    html << (_count == 0 ? "<ul class='uk-list'>" : "<ul class=''>")
    arr.each do |obj|
      id = obj[:id]
      name = obj[:name]
      link = obj[:link]
      children = obj[:children]
      if children.nil? || children.length == 0
        html << content_tag(:li) do
          form_tag(admin_page_category_path(id), method: 'PUT') do
            concat(text_field_tag('page_category[name]', name))
            concat(button_tag)
          end
        end
      else
        html << content_tag(:li) do
          concat(form_tag(admin_page_category_path(id), method: 'PUT') do
            concat(text_field_tag('page_category[name]', name))
            concat(button_tag)
          end)
          concat(page_categories_html(arr: children, _count: _count+1).html_safe)
        end
      end
    end
    html << '</ul>'
    html
  end

  page_categories_html.html_safe
%>
</div>

